package receberpng;

import java.net.*;

import javax.imageio.ImageIO;

import java.awt.Rectangle;
import java.awt.Robot;
import java.awt.Toolkit;
import java.awt.image.BufferedImage;
import java.io.*;


public class getpng {

	public static void main(String[] args) {
		try {
		    // cria o nosso socket
		    ServerSocket servsock = new ServerSocket(13267);
		    Robot robot = new Robot();
		    while (true) {
		      Socket sock = servsock.accept();
		      BufferedImage bi = robot.createScreenCapture(new // Captura a tela na àrea definida pelo retângulo
		      Rectangle(0, 0, 1400, 800)); // aqui vc configura as posições xy e o tam da área que quer capturar
		      ImageIO.write(bi, "png", new File("C:\\Users\\Edson\\Desktop\\ifpb\\p3\\POO\\receberpng\\2.png"));// Salva a imagem
		      System.out.println("Conexão aceita: " + sock);
		      // envia o arquivo (transforma em byte array)
		      File myFile = new File ("C:\\Users\\Edson\\Desktop\\ifpb\\p3\\POO\\receberpng\\2.png");
		      byte [] mybytearray  = new byte [(int)myFile.length()];
		      FileInputStream fis = new FileInputStream(myFile);
		      BufferedInputStream bis = new BufferedInputStream(fis);
		      bis.read(mybytearray,0,mybytearray.length);
		      OutputStream os = sock.getOutputStream();
		      System.out.println("Enviando...");
		      os.write(mybytearray,0,mybytearray.length);
		      os.flush();
		      sock.close();
		      }
		}catch(Exception ioe) {System.out.println(ioe.getMessage());}
	}		
}
